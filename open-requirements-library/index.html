<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Practice Guidebook</title>
    <!-- Inter font for clean typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --red-700: #b91c1c;
            --red-800: #991b1b;
            --red-100: #fee2e2;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            min-height: 100vh;
            background-color: var(--gray-100);
            color: var(--gray-800);
        }
        
        .scrollbar-hidden::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .sidebar {
            width: 16rem; /* 64px = 16rem */
            flex-shrink: 0;
            background-color: var(--red-700);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease-in-out;
        }

        .sidebar-header {
            padding: 1.5rem;
        }
        
        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }
        
        .sidebar-header p {
            font-size: 0.875rem;
            color: var(--red-100);
            margin-top: 0.25rem;
        }

        .navigation-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .navigation-link {
            display: block;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .navigation-link:hover {
            background-color: var(--red-800);
        }
        
        .navigation-link.active {
            background-color: var(--red-800);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .content-wrapper {
            max-width: 56rem; /* 4xl = 56rem */
            margin: 0 auto;
            width: 100%;
        }

        .content-container {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Styles to mimic Tailwind's 'prose' plugin for markdown content */
        .content-container h1 { font-size: 2.25rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem; }
        .content-container h2 { font-size: 1.875rem; font-weight: 600; color: var(--gray-800); margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .content-container h3 { font-size: 1.5rem; font-weight: 600; color: var(--gray-800); margin-top: 1.25rem; margin-bottom: 0.5rem; }
        .content-container p { font-size: 1rem; line-height: 1.75rem; color: var(--gray-600); margin-top: 1rem; margin-bottom: 1rem; }
        .content-container ul { list-style-type: disc; margin-left: 1.5rem; margin-top: 0.5rem; }
        .content-container ol { list-style-type: decimal; margin-left: 1.5rem; margin-top: 0.5rem; }
        .content-container li { margin-bottom: 0.25rem; }
        .content-container a { color: var(--red-700); text-decoration: underline; }
        .content-container img { max-width: 100%; height: auto; border-radius: 0.5rem; margin-top: 1rem; margin-bottom: 1rem; }
        .content-container pre { background-color: var(--gray-800); color: white; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: monospace; }
        .content-container code { background-color: var(--gray-200); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: 600; }

        .pagination-container {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .pagination-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            background-color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            color: var(--gray-700);
            transition: background-color 0.2s;
        }
        
        .pagination-button:hover {
            background-color: var(--gray-200);
        }
    </style>
</head>
<body class="body-container">

    <!-- Sidebar for navigation -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h1>Open Practice</h1>
            <p>Requirements Library</p>
        </div>
        <nav id="navigation" class="navigation-list scrollbar-hidden">
            <div role="list" class="navigation-list-items">
                <!-- Navigation links will be populated here by JavaScript -->
                <p style="color: var(--gray-200); font-size: 0.875rem; padding: 1rem; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;">Loading navigation...</p>
            </div>
        </nav>
    </aside>

    <!-- Main content area -->
    <main class="main-content scrollbar-hidden">
        <div class="content-wrapper">
            <article id="content-container" class="content-container">
                <!-- Markdown content will be rendered here -->
                <h1>Welcome</h1>
                <p>
                    Select a document from the navigation sidebar to get started. The content will appear here.
                </p>
            </article>

            <!-- Pagination/navigation for Next/Previous links -->
            <div id="pagination-container" class="pagination-container">
                <!-- Buttons will be populated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- JavaScript for dynamic content loading -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Use an IIFE (Immediately Invoked Function Expression) to avoid global scope pollution
        (async function() {
            // Configuration for the repository and branch
            const repoOwner = 'CivicActions';
            const repoName = 'open-practice';
            const branch = 'main';
            const contentPath = 'open-requirements-library';

            // DOM elements
            const navigationContainer = document.getElementById('navigation').querySelector('div');
            const contentContainer = document.getElementById('content-container');
            const paginationContainer = document.getElementById('pagination-container');
            
            // Global variable to store the file list and current file index
            let markdownFiles = [];
            let currentFileIndex = -1;

            // Function to fetch the list of files from GitHub's API
            async function fetchFileList() {
                const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${contentPath}?ref=${branch}`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`GitHub API error: ${response.statusText}`);
                    }
                    const files = await response.json();
                    return files.filter(file => file.name.endsWith('.md'));
                } catch (error) {
                    console.error("Failed to fetch file list:", error);
                    navigationContainer.innerHTML = '<p class="text-red-200 p-4">Error loading files. Check console for details.</p>';
                    return [];
                }
            }

            // Function to fetch and render the content of a markdown file
            async function fetchAndRenderMarkdown(filename, index) {
                // Update the current file index
                currentFileIndex = index;

                const url = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${contentPath}/${filename}`;
                contentContainer.innerHTML = `<p style="text-align: center; color: var(--gray-500); padding: 2rem 0;">Loading ${filename}...</p>`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch markdown file: ${response.statusText}`);
                    }
                    const markdownText = await response.text();
                    // Use marked.js to convert markdown to HTML
                    const html = marked.parse(markdownText);
                    contentContainer.innerHTML = html;
                    
                    // Update the pagination links after content is loaded
                    updatePagination();

                    // Scroll to the top of the content area
                    contentContainer.scrollTop = 0;
                } catch (error) {
                    console.error("Failed to fetch and render markdown:", error);
                    contentContainer.innerHTML = `<p style="color: var(--red-700); padding: 2rem 0;">Error loading content. Please try again later.</p>`;
                    // Clear pagination on error
                    paginationContainer.innerHTML = '';
                }
            }
            
            // Function to update the pagination links
            function updatePagination() {
                paginationContainer.innerHTML = ''; // Clear existing buttons
                
                const prevFile = markdownFiles[currentFileIndex - 1];
                const nextFile = markdownFiles[currentFileIndex + 1];

                // Create and append the "Previous" button if it exists
                if (prevFile) {
                    const prevButton = document.createElement('a');
                    prevButton.href = '#';
                    prevButton.textContent = '← Previous';
                    prevButton.classList.add('pagination-button');
                    prevButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        fetchAndRenderMarkdown(prevFile.name, currentFileIndex - 1);
                        updateActiveLink(prevFile.name);
                    });
                    paginationContainer.appendChild(prevButton);
                } else {
                    // Add an empty div for spacing if no previous button
                    const spacer = document.createElement('div');
                    paginationContainer.appendChild(spacer);
                }

                // Create and append the "Next" button if it exists
                if (nextFile) {
                    const nextButton = document.createElement('a');
                    nextButton.href = '#';
                    nextButton.textContent = 'Next →';
                    nextButton.classList.add('pagination-button');
                    nextButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        fetchAndRenderMarkdown(nextFile.name, currentFileIndex + 1);
                        updateActiveLink(nextFile.name);
                    });
                    paginationContainer.appendChild(nextButton);
                }
            }

            // Function to update the active state of a link in the sidebar
            function updateActiveLink(filename) {
                const currentActive = navigationContainer.querySelector('.active');
                if (currentActive) {
                    currentActive.classList.remove('active');
                }
                const newActiveLink = navigationContainer.querySelector(`a[data-filename="${filename}"]`);
                if (newActiveLink) {
                    newActiveLink.classList.add('active');
                }
            }

            // Main function to initialize the app
            async function initialize() {
                markdownFiles = await fetchFileList();

                // Clear the loading message
                navigationContainer.innerHTML = '';

                if (markdownFiles.length === 0) {
                    navigationContainer.innerHTML = '<p style="color: var(--gray-200); padding: 1rem;">No markdown files found.</p>';
                    return;
                }

                // Build navigation links
                markdownFiles.forEach((file, index) => {
                    const link = document.createElement('a');
                    link.href = '#'; // Use a hash to prevent full page reloads
                    link.textContent = file.name.replace('.md', '').split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    link.classList.add('navigation-link');
                    link.setAttribute('data-filename', file.name); // Store filename for easy lookup
                    
                    // Add click event listener to each link
                    link.addEventListener('click', (event) => {
                        event.preventDefault(); // Prevent default link behavior
                        fetchAndRenderMarkdown(file.name, index);
                        updateActiveLink(file.name);
                    });
                    
                    navigationContainer.appendChild(link);
                });
                
                // Load the first markdown file on page load
                if (markdownFiles.length > 0) {
                    const firstFile = markdownFiles[0];
                    fetchAndRenderMarkdown(firstFile.name, 0);
                    updateActiveLink(firstFile.name);
                }
            }
            
            // Start the application
            initialize();
        })();
    </script>
</body>
</html>
